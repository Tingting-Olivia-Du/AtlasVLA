# Training configuration for Atlas VLA

# Model configuration
model:
  vggt_checkpoint: "facebook/VGGT-1B"
  lang_encoder_name: "meta-llama/Meta-Llama-3-8B"  # 更新为Llama-3-8B
  freeze_vggt: true
  freeze_lang_encoder: true
  geom_output_dim: 512
  fusion_hidden_dim: 1024
  action_dim: 7  # 7 for 欧拉角，8 for 四元数
  use_pointnet: true
  use_pose: true
  # 改进3: 四元数表示选项
  use_quaternion: false  # 是否使用四元数表示旋转（推荐true，避免欧拉角奇异性）
  # 改进2: Diffusion Head选项
  use_diffusion_head: false  # 是否使用Diffusion Action Head（默认false，使用传统回归head）
  # 改进5: Fusion模块改进
  use_attention_pooling: true  # 是否使用attention pooling（推荐true）

# HuggingFace authentication
huggingface:
  # HuggingFace token (用于访问私有模型)
  token: "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"  # 你的HuggingFace token
  # 或者设置为null，使用环境变量HF_TOKEN或通过huggingface-cli login
  # token: null

# Data configuration
data:
  # 数据源选择：HuggingFace或本地数据
  use_huggingface: true  # true = 使用HuggingFace数据（推荐），false = 使用本地HDF5转换后的数据
  
  # HuggingFace数据配置（当use_huggingface=true时使用）
  hf_dataset_name: "physical-intelligence/libero"  # HuggingFace数据集名称
  streaming: false  # false = 下载并缓存，true = 流式加载（节省内存但需要网络）
  hf_cache_dir: null  # HuggingFace缓存目录（null = 使用默认）
  
  # 本地数据配置（当use_huggingface=false时使用）
  data_dir: "./dataset"  # LIBERO数据集路径（相对于项目根目录，HDF5转换后的格式）
  
  # 通用配置
  train_split: "train"
  val_split: null  # HuggingFace数据通常只有train，设为null跳过验证集
  image_size: 518  # VGGT input size
  use_wrist_camera: true
  batch_size: 8
  num_workers: 4
  # 改进4: 多帧时序训练配置
  num_temporal_frames: 1  # 时序帧数（1=单帧，2+=多帧时序）
  temporal_stride: 1  # 帧之间的步长
  # 改进1: 动作归一化配置
  normalize_actions: false  # 是否归一化动作（推荐true，解决尺度差异问题）
  action_stats_path: null  # 动作统计信息文件路径（null=自动计算）

# Training configuration
training:
  num_epochs: 50
  # 改进7: 超参数调整
  learning_rate: 0.00005  # 降低学习率（从0.0001降到0.00005）以提高训练稳定性
  weight_decay: 0.001  # 降低weight_decay（从0.01降到0.001）减少正则化强度
  warmup_steps: 2000  # 增加warmup步数（从1000到2000）让学习率更平滑地增长
  gradient_accumulation_steps: 1  # Accumulate gradients over N steps before updating (simulates larger batch size)
  
  # Loss weights
  loss:
    pose_weight: 1.0
    gripper_weight: 0.5
    pose_loss_type: "smooth_l1"  # "l1", "l2", or "smooth_l1"
    gripper_loss_type: "l1"  # "l1" or "bce"
    # 改进6: 辅助损失配置
    use_auxiliary_loss: false  # 是否启用辅助损失（默认关闭，可根据需要开启）
    geom_consistency_weight: 0.1  # 几何一致性损失权重
    feature_reg_weight: 0.01  # 特征正则化损失权重
  
  # Logging intervals
  log_interval: 100
  val_interval: 1000
  save_interval: 5000

# Checkpointing
checkpoint:
  save_dir: "./checkpoints"
  resume_from: null  # Path to checkpoint to resume from

# Logging configuration
logging:
  # 是否保存训练日志到文件
  save_to_file: true
  # 日志文件保存路径（null = 自动生成，格式: logs/train_YYYYMMDD_HHMMSS.log）
  log_file: null  # 例如: "logs/train.log" 或 null 自动生成
  # 日志目录（如果log_file为null，会在此目录下自动生成日志文件）
  log_dir: "./logs"
  # 是否同时输出到控制台
  console_output: true

# Experiment tracking with Weights & Biases (wandb)
wandb:
  enabled: false  # 设置为 true 启用wandb记录
  project: "atlas-vla"  # wandb项目名称
  entity: tingtingdu06-uw-madison  # 你的wandb用户名/团队名（留空使用默认）
  name: null  # 实验名称（留空自动生成，格式: atlas-vla-YYYYMMDD-HHMMSS）
  tags: []  # 实验标签，例如: ["baseline", "vggt-frozen"]
  notes: ""  # 实验备注/描述
  save_code: true  # 是否保存代码到wandb
  resume: "allow"  # 如果实验已存在，如何处理: "allow", "must", "never", "auto"

# Device
device: "cuda"
